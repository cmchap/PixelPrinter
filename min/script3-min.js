function setCanvasSize(e,a,t){e.width=a,e.height=t}function resetAll(){context.clearRect(0,0,canvas[0].width,canvas[0].height),zcontext.clearRect(0,0,zcanvas[0].width,zcanvas[0].height),scontext.clearRect(0,0,scanvas[0].width,scanvas[0].height),zcontext.restore(),canvas[0].width=0,canvas[0].height=0,scanvas[0].width=0,scanvas[0].height=0,zcanvas[0].style.visibility="hidden",$("#make-grayscale").attr("checked",!1),savedcolorlist.empty(),savedcolors=[],console.clear(),console.log("Reset All")}function readSelector(e){return"mushroom"===e.value?"images/mushroom.png":"yoshi"===e.value?"images/yoshi.png":"pikachu"===e.value?"images/pikachu.png":"testing"===e.value?"images/testing.png":"red"===e.value?"images/red.png":"rhino"===e.value?"images/rhino.jpg":"questionmark"===e.value?"images/questionmark.png":"mario"===e.value?"images/marioicon.png":null}function getFittingRatio(e,a){var t=1;if(e.width>a.width||e.height>a.height){var o=a.width/e.width,n=a.height/e.height;t=Math.min(o,n)}return t}function fitImageToCanvas(e,a){ratio=getFittingRatio(e,a),a.width=e.width*ratio,a.height=e.height*ratio}function makeGrayscale(e,a,t){if(t.checked===!1)a.putImageData(originalImageData,0,0);else{for(var o=a.getImageData(0,0,e.width,e.height),n=o.data,s=0;s<n.length;s+=4){var i=(n[s]+n[s+1]+n[s+2])/3;n[s]=i,n[s+1]=i,n[s+2]=i}a.putImageData(o,0,0)}}function setImageFromFile(e,a,t,o,n){if(n.append($("<option/>",{value:"none",text:"Select an image"})),n.val("none"),resetAll(),setCanvasSize(t,200,200),e.files&&e.files[0]){var s=new FileReader;s.onload=function(e){a.onload=function(){var e=getFittingRatio(a,t);fitImageToCanvas(a,t),o.drawImage(a,0,0,a.width,a.height,0,0,a.width*e,a.height*e),originalImageData=context.getImageData(0,0,canvas[0].width,canvas[0].height)},a.src=e.target.result},s.readAsDataURL(e.files[0])}}function setImageFromSelector(e,a,t,o){var n=readSelector(a[0]);if(null!==n){resetAll(),setCanvasSize(t,200,200),e.onload=function(){var a=getFittingRatio(e,t);fitImageToCanvas(e,t),o.drawImage(e,0,0,e.width,e.height,0,0,e.width*a,e.height*a),originalImageData=context.getImageData(0,0,canvas[0].width,canvas[0].height)},e.src=n;var s=a.children("option[value='none']");s&&s.remove()}}function getMousePos(e,a){var t=e.getBoundingClientRect();return{x:a.clientX-Math.floor(t.left),y:a.clientY-Math.floor(t.top)}}function showZoom(e,a,t,o,n,s){var i=getMousePos(a,s),l=0,c=0,r=a.width,g=a.height,v=-1*i.x-.5,h=-1*i.y-.5,d=a.width,u=a.height;n.imageSmoothingEnabled=!1,n.clearRect(t.width/2*-1,t.height/2*-1,t.width,t.height),n.drawImage(a,l,c,r,g,v,h,d,u);var m=4/e,f=1,p=1,y=f/-2,w=p/-2;n.strokeStyle="black",n.lineWidth=m,n.strokeRect(y,w,f,p)}function getNewScale(e,a,t,o){var n=1,s;return o.deltaY>0&&(console.log("zoomed in"),s=totalscale*(n+t),s>a?(console.log("special case"),console.log("newscalingfactor = ",n),n=a/totalscale,console.log("newscalingfactor = ",n),console.log("totalscale = ",totalscale),totalscale*=n,console.log("totalscale = ",totalscale)):(n+=t,console.log(n),totalscale*=n,console.log(totalscale))),o.deltaY<0&&(console.log("zoomed out"),s=totalscale*(n-t),e>s?(console.log("special case"),console.log("newscalingfactor = ",n),n=e/totalscale,console.log("newscalingfactor = ",n),console.log("totalscale = ",totalscale),totalscale*=n,console.log("totalscale = ",totalscale)):(n-=t,console.log(n),totalscale*=n,console.log(totalscale))),console.log("newscalingfactor = ",n),console.log("totalscale = ",totalscale),n}function existsInArray(e,a){var t,o,n;for(t=0;t<a.length;++t)if(e.length===a[t].length){for(n=a[t],o=0;o<e.length&&e[o]===n[o];++o);if(o===e.length)return t}return-1}function getColorUnderMouse(e,a,t){var o=getMousePos(e,t),n=a.getImageData(o.x,o.y,1,1).data,s=n[0],i=n[1],l=n[2],c=n[3]/255;return[s,i,l,c]}function updateSelectedColor(e,a,t){var o=getColorUnderMouse(e,a,t);$("#selected-color").css("background-color","rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")"),$("#current-color-rgba").html(" rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")")}function showHideSimplifyColorsButton(e){2===e.length&&$("#simplify-colors-button").is(":visible")===!1?$("#simplify-colors-button").show():1===e.length&&$("#simplify-colors-button").is(":visible")===!0&&$("#simplify-colors-button").hide()}function saveColor(e,a,t,o,n){var s=getColorUnderMouse(e,a,n),i=existsInArray(s,o);if(i>-1)return void alert("You've already saved color rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")");if(o.length>=10)return void alert("You have already saved 10 colors. Too many colors won't look right. Remove some colors before continuing.");var l=$("<tr>",{"class":"saved-color"}).appendTo(t),c=$("<td>").appendTo(l),r=$("<td>",{"class":"color-swatch",style:"background-color: rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+")"}).appendTo(l),g=$("<td>",{html:" rgba("+s[0]+","+s[1]+","+s[2]+","+s[3]+") "}).appendTo(l),v=$("<td>").appendTo(l),h=$("<button>",{"class":"remove",html:"Remove"}).appendTo(v);o.push(s),h.on("click",function(){removeSavedColor($(this),o),showHideSimplifyColorsButton(o)}),showHideSimplifyColorsButton(o)}function removeSavedColor(e,a){var t=e.closest("tr"),o=t.prevAll().length;a.splice(o,1),t.remove()}function simplifyColors(e,a,t,o,n){for(var s=a.getImageData(0,0,e.width,e.height),i=s.data,l=0;l<i.length;l+=4){var c=[],r=i[l],g=i[l+1],v=i[l+2],h=(r+g+v)/3;h=Math.round(h),r=h,g=h,v=h;for(var d=0;d<n.length;d++){var u=n[d][0],m=n[d][1],f=n[d][2],p=(u+m+f)/3;if(p=Math.round(p),u=p,m=p,f=p,r===u&&g===m&&v===f){c.push(0);break}var y=Math.abs(u-r);c.push(y)}var w=c.indexOf(Math.min.apply(this,c)),z=(n[w][0]+n[w][1]+n[w][2])/3;i[l]=z,i[l+1]=z,i[l+2]=z}t.width=e.width,t.height=e.height,o.putImageData(s,0,0),simplifiedImageData=s,greyscalesavedcolors=[];for(var x=0;x<n.length;x++){var b=(n[x][0]+n[x][1]+n[x][2])/3;b=Math.round(b),greyscalesavedcolors.push(b)}}function generateArray(e,a,t){function o(e,a){return a-e}for(var n=[],s=[],i=[],l=a.sort(o),c=0;c<e.data.length;c+=4){0===e.data[c+3]&&(e.data[c]=255,e.data[c+1]=255,e.data[c+2]=255,e.data[c+3]=255);var r=$.inArray(e.data[c],l)+1;n.push(r)}for(var g=0;g<n.length;g++)i.push(n[g]),(g+1)%t.width===0&&(s.push(i),i=[]);var v=JSON.stringify(s);return v}function generateArrayOriginal(e,a){function t(e,a){return a-e}for(var o=[],n=e.data,s=[],i=[],l=[],c=0;c<n.length;c+=4){0===n[c+3]&&(n[c]=255,n[c+1]=255,n[c+2]=255,n[c+3]=255);var r=Math.round((n[c]+n[c+1]+n[c+2])/3);n[c]=r,n[c+1]=r,n[c+2]=r,-1===$.inArray(r,o)&&o.push(r)}for(var g=o.sort(t),v=0;v<n.length;v+=4){var h=$.inArray(n[v],g)+1;s.push(h)}for(var d=0;d<s.length;d++)l.push(s[d]),(d+1)%a.width===0&&(i.push(l),l=[]);var u=JSON.stringify(i);return u}var test="this is a test variable",selector=$("#selector"),sourceimage=new Image,canvas=$("#original-canvas"),context=canvas[0].getContext("2d"),zcanvas=$("#zoom-canvas"),zcontext=zcanvas[0].getContext("2d"),scalingfactor=10,zoomcanvassize=250,totalscale=scalingfactor,scrollzoomincrement=.25,minzoomamount=1,maxzoomamount=25,currentcolor=$("#current-color"),scanvas=$("#simplified-canvas"),scontext=scanvas[0].getContext("2d"),savedcolorlist=$("#saved-color-list"),savedcolors=[],originalImageData,simplifiedImageData,greyscalesavedcolors=[];$(window).load(function(){setImageFromSelector(sourceimage,selector,canvas[0],context),$("#simplify-colors-button").hide(),zcanvas[0].style.visibility="hidden",currentcolor[0].style.visibility="hidden",zcanvas[0].width=zoomcanvassize,zcanvas[0].height=zoomcanvassize,zcontext.translate(zoomcanvassize/2,zoomcanvassize/2),zcontext.scale(scalingfactor,scalingfactor),zcontext.save()}),selector.change(function(){setImageFromSelector(sourceimage,selector,canvas[0],context)}),$("#file-upload").change(function(){setImageFromFile(this,sourceimage,canvas[0],context,selector)}),$("#make-grayscale").click(function(){makeGrayscale(canvas[0],context,this)}),canvas.mouseenter(function(){zcanvas[0].style.visibility="visible",currentcolor[0].style.visibility="visible"}),canvas.mouseout(function(){zcanvas[0].style.visibility="hidden",currentcolor[0].style.visibility="hidden"}),canvas.mousemove(function(e){updateSelectedColor(canvas[0],context,e),showZoom(totalscale,canvas[0],zcanvas[0],context,zcontext,e)}),canvas.mousewheel(function(e){console.log("e.deltaY = ",e.deltaY),e.preventDefault();var a=getNewScale(minzoomamount,maxzoomamount,scrollzoomincrement,e);zcontext.scale(a,a),showZoom(totalscale,canvas[0],zcanvas[0],context,zcontext,e)}),canvas.click(function(e){saveColor(canvas[0],context,savedcolorlist,savedcolors,e)}),$("#simplify-colors-button").click(function(){simplifyColors(canvas[0],context,scanvas[0],scontext,savedcolors)}),scanvas.mouseenter(function(){zcanvas[0].style.visibility="visible"}),scanvas.mouseout(function(){zcanvas[0].style.visibility="hidden"}),scanvas.mousemove(function(e){updateSelectedColor(scanvas[0],scontext,e),showZoom(totalscale,scanvas[0],zcanvas[0],scontext,zcontext,e)}),$("#create-simplified").click(function(){$('td:contains("New Bitmap Array").caption').next().children("input").val(generateArray(simplifiedImageData,greyscalesavedcolors,scanvas[0])),$(".parameterstable").next('button:contains("Update")').trigger("click")}),$("#create-original").click(function(){$('td:contains("New Bitmap Array").caption').next().children("input").val(generateArrayOriginal(originalImageData,canvas[0])),$(".parameterstable").next('button:contains("Update")').trigger("click")});